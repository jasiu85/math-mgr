\section{Definicja alternatywna}

\noindent
Na podstawie podanej definicji iloczynu Weila
udało nam się udowodnić szereg jego własności.
Definicja ta nie nadaje się jednak do tego,
aby skonstruować na jej podstawie
wydajny algorytm obliczający wartości iloczynu Weila.
Dlatego podamy teraz alternatywną definicję,
która lepiej nada się do celów obliczeniowych.

\subsection*{Definicja}

\noindent
Alternatywna definicja iloczynu Weila jest następująca.

\begin{definition}\label{weil_pairing_alt_def}
Dana jest krzywa eliptyczna $E$ nad ciałem $\K$
oraz liczba całkowita $n$.
Niech $P$ i $Q$ będą dowolnymi punktami na krzywej $E$.
Niech $f_P'$ i $f_Q'$ będą funkcjami wymiernymi na krzywej $E$
określonymi z dokładnością do niezerowego czynnika stałego
poprzez podanie ich dywizorów:
\begin{eqnarray*}
\rdiv(f_P') & = & n\divi{P} - n\divi{\ecident} \\
\rdiv(f_Q') & = & n\divi{Q} - n\divi{\ecident}
\end{eqnarray*}
\emph{Alternatywna postać iloczynu Weila}
to funkcja $w'\colon E[n] \to \K$
określona następująco:
\begin{equation}\label{weil_pairing_alt_eqn}
w'(P, Q) = (-1)^n\frac{f_P'(Q)}{f_Q'(P)}\frac{f_Q'}{f_P'}(\ecident)
\end{equation}
\end{definition}

\begin{remark}
Funkcje $f_P'$ i $f_Q'$ są wyznaczone z dokładnością do stałej,
ale nie wpływa to na wartość funkcji $w'(P, Q)$,
zatem jest ona dobrze określona.
\end{remark}

\subsection*{Symbol lokalny i prawo wzajemności Weila}

\noindent
Aby móc udowodnić równoważność obu definicji,
wprowadzimy tzw. symbol lokalny
i posłużymy się ważną zależnością, którą spełnia:
prawem wzajemności Weila.

\begin{definition}
Dany jest punkt $P$ na krzywej eliptycznej $E$.
Niech $r$ i $s$ będą dwoma niezerowymi funkcjami wymiernymi na krzywej $E$.
\emph{Symbol lokalny $\lsym{r}{s}{P}$}
określony jest następująco:
\begin{equation}
\lsym{r}{s}{P} =
(-1)^{\ord_P(r)\ord_P(s)}\left(\frac{r^{\ord_P(s)}}{s^{\ord_P(r)}}\right)(P)
\end{equation}
\end{definition}

\noindent
Podstawowe własności symbolu lokalnego podsumowuje następujące twierdzenie.

\begin{theorem}
Dany jest punkt $P$ na krzywej eliptycznej $E$.
Niech $r$, $r_1$, $r_2$, $s$, $s_1$ i $s_2$
będą dowolnymi niezerowymi funkcjami wymiernymi na krzywej $E$.
Wówczas zachodzą następujące zależności:
\begin{itemize}
\item
$\lsym{r}{s}{P} \neq 0$;
\item
jeżeli funkcje $r$ i $s$ nie mają w punkcie $P$
ani miejsca zerowego, ani bieguna,
to $\lsym{r}{s}{P} = 1$;
\item
$\lsym{-r}{r}{P} = 1$;
\item
$\lsym{1-r}{r}{P} = 1$;
\item
$\lsym{r}{s}{P}\lsym{s}{r}{P} = 1$;
\item
$\lsym{r_1r_2}{s}{P} = \lsym{r_1}{s}{P}\lsym{r_2}{s}{P}$;
\item
$\lsym{r}{s_1s_2}{P} = \lsym{r}{s_1}{P}\lsym{r}{s_2}{P}$;
\item
jeżeli $\ord_P(r) = 0$, to $\lsym{r}{s}{P} = r(P)^{\ord_P(s)}$;
\item
jeżeli $\ord_P(s) = 0$, to $\lsym{r}{s}{P} = \frac{1}{s(P)^{\ord_P(r)}}$;
\item
jeżeli $\ord_P(1-s) > 0$ oraz $\ord_P(r) \neq 0$, to $\lsym{r}{s}{P} = 1$.
\end{itemize}
\end{theorem}

\noindent
Nietrywialną własnością symbolu lokalnego jest następująca zależność.

\begin{theorem}[Prawo wzajemności Weila]
Dane są niezerowe funkcje wymierne $r$ i $s$ na krzywej eliptycznej $E$.
Wówczas zachodzi następująca zależność:
\begin{equation}
\prod_{P \in E} \lsym{r}{s}{P} = 1
\end{equation}
\end{theorem}

\noindent
Dowód prawa wzajemności Weila znacznie wykracza
poza zakres niniejszej pracy, dlatego nie podajemy go.

\subsection*{Równoważność obu definicji}

\noindent
Udowodnimy teraz, że obie definicje iloczynu Weila są równoważne.

\begin{theorem}
Dane są punkty $P$ i $Q$ rzędu $n$ na krzywej eliptycznej $E$ nad ciałem $\K$.
Wówczas zachodzi następująca zależność:
\begin{equation}
w(P, Q) = w'(P, Q)
\end{equation}
\end{theorem}

\begin{proof}
Zakładamy, że $P \neq Q$, $P \neq \ecident$, $Q \neq \ecident$,
gdyż w tych przypadkach łatwo sprawdzić, że żądana równość zachodzi.

\noindent
Niech $f_P$ oraz $f_Q$ będą funkcjami wymiernymi na krzywej $E$
określonymi w definicji \ref{weil_pairing_def}.
Poprzez analizę krotności miejsc zerowych i biegunów możemy sprawdzić,
że następujące dywizory są równe:
\begin{eqnarray*}
\rdiv({f_P}^n) & = & \rdiv(f_P' \circ [n]) \\
\rdiv({f_Q}^n) & = & \rdiv(f_Q' \circ [n])
\end{eqnarray*}
Przyjmijmy więc, że funkcje $f_P'$ i $f_Q'$ są wybrane tak,
aby zachodziły następujące równości:
\begin{eqnarray*}
{f_P}^n & = & f_P' \circ [n] \\
{f_Q}^n & = & f_Q' \circ [n]
\end{eqnarray*}

\noindent
Dalej, przyjmijmy, że $P', Q' \in E$ są takimi punktami,
że $P = nP'$ oraz $Q = nQ'$.
Rozważmy następujący dywizor:
\begin{equation*}
(n-1)\divi{Q'} + \divi{Q' - Q} - n\divi{\ecident}
\end{equation*}
Stosując lemat \ref{divi_reduction_lemma} sprawdzamy,
że jest to dywizor główny.
Niech więc $r$ będzie funkcją wymierną na krzywej $E$ o takim dywizorze:
\begin{equation*}
\rdiv(r) = (n-1)\divi{Q'} + \divi{Q' - Q} - n\divi{\ecident}
\end{equation*}

\noindent
Stosujemy uogólnione prawo wzajemności Weila do funkcji $f_P$ i $r$:
\begin{equation}\label{weil_reci_fp_r}
\prod_{S \in E} \lsym{f_P}{r}{S} = 1
\end{equation}

\noindent
Ze względu na własności symbolu lokalnego dla większości punktów $S$
będzie zachodzić $\lsym{f_P}{r}{S} = 1$.
Jedyne punkty, dla których może być inaczej,
to $Q'$, $Q' - Q$ oraz miejsca zerowe i bieguny funkcji $f_P$.
Policzymy wartość symbolu lokalnego dla tych punktów.

\noindent
Zacznijmy od punktu $Q'$. W tym punkcie zachodzi
$\ord_{Q'}(f_P) = 0$ oraz $\ord_{Q'}(r) = n-1$,
więc z własności symbolu lokalnego otrzymujemy:
\begin{equation*}
\lsym{f_P}{r}{Q'} = f_P(Q')^{n-1}
\end{equation*}
Teraz rozważamy punkt $Q' - Q$.
Tym razem $\ord_{Q' - Q}(f_P) = 0$ oraz $\ord_{Q' - Q}(r) = 1$.
Dostajemy:
\begin{equation*}
\lsym{f_P}{r}{Q' - Q} = f_P(Q' - Q)
\end{equation*}
Wymnażamy obie równości:
\begin{eqnarray*}
\lsym{f_P}{r}{Q'}\lsym{f_P}{r}{Q' - Q}
& = & f_P(Q')^{n-1} f_P(Q - Q') \\
& = & \frac{f_P(Q' - Q)}{f_P(Q')} f_P(Q')^n \\
& = & \frac{f_P}{f_P \circ t_Q}(Q' - Q) f_P(Q')^n \\
& = & w(P,Q)^{-1} f_P(Q')^n \\
& = & w(P,Q)^{-1} (f_P' \circ [n])(Q') \\
& = & w(P,Q)^{-1} f_P'(Q)
\end{eqnarray*}

\noindent
Zanim obliczymy wartość symbolu lokalnego
dla miejsc zerowych i biegunów funkcji $f_P$,
rozważmy następującą funkcję pomocniczą $\widehat{r}$:
\begin{equation*}
\widehat{r}(T) = \prod_{S \in E[n]} r(S + T)
\end{equation*}
Jej dywizor jest równy:
\begin{equation*}
\rdiv(\widehat{r}) = \sum_{S \in E[n]} \rdiv(r \circ t_S)
\end{equation*}
Zauważmy, że zachodzi:
\begin{equation*}
\rdiv(r \circ t_S) = (n-1)\divi{Q' - S} + \divi{Q' - Q - S} - n\divi{-S}
\end{equation*}
Stąd otrzymujemy:
\begin{eqnarray*}
\rdiv(\widehat{r})
& = & \sum_{S \in E[n]} \rdiv(r \circ t_S) \\
& = & \sum_{S \in E[n]} (n-1)\divi{Q' - S} + \divi{Q' - Q - S} - n\divi{-S} \\
& = & (n-1)\sum_{S \in E[n]}\divi{Q' + S} +
      \sum_{S \in E[n]}\divi{Q' + S} -
      n\sum_{S \in E[n]}\divi{S} \\
& = & n[n]^{-1}(Q) - n[n]^{-1}(\ecident) \\
& = & \rdiv({f_Q}^n) \\
& = & \rdiv(f_Q' \circ [n])
\end{eqnarray*}
Wybraliśmy funkcję $r$ dowolnie, więc przyjmijmy teraz,
że została wybrana tak, żeby zachodziła następująca zależność:
\begin{equation*}
\widehat{r} = f_Q' \circ [n]
\end{equation*}

\noindent
Obliczymy teraz fragment iloczynu \ref{weil_reci_fp_r},
który odpowiada miejscom zerowym funkcji $f_P$.
Dla każdego miejsca zerowego $S$ funkcji $f_P$
mamy $\ord_S(f_P) = 1$ oraz $\ord_S(r) = 0$.
Zatem:
\begin{eqnarray*}
\prod_{\ord_S(f_P) > 0} \lsym{f_P}{r}{S}
& = & \prod_{\ord_S(f_P) > 0} \frac{1}{r(S)} \\
& = & \prod_{S \in E[n]} \frac{1}{r(P' + S)} \\
& = & \frac{1}{\widehat{r}(P')} \\
& = & \frac{1}{(f_Q' \circ [n])(P')} \\
& = & \frac{1}{f_Q'(P)}
\end{eqnarray*}

\noindent
Podobnie postępujemy z fragmentem iloczynu $\ref{weil_reci_fp_r}$,
który odpowiada biegunom funkcji $f_P$. Pamiętajmy przy tym,
że punkt $\ecident$ jest również biegunem stopnia $n$ funkcji $r$.
\begin{eqnarray*}
\prod_{\ord_S(f_P) < 0} \lsym{f_P}{r}{S}
& = & \lsym{f_P}{r}{\ecident}
      \prod_{S \in E[n] \setminus \{\ecident\}} r(S) \\
& = & (-1)^{n}\frac{{f_P}^{-n}}{r^{-1}}(\ecident)
      \prod_{S \in E[n] \setminus \{\ecident\}} r(S) \\
& = & (-1)^{n}\frac{{f_P}^{-n}}{\widehat{r}^{-1}}(\ecident) \\
& = & (-1)^{n}\frac{\widehat{r}}{{f_P}^n}(\ecident) \\
& = & (-1)^{n}\frac{f_Q' \circ [n]}{f_P' \circ [n]}(\ecident) \\
& = & (-1)^{n}\frac{f_Q'}{f_P'}(\ecident)
\end{eqnarray*}

\noindent
Rozpiszmy jeszcze raz wzór \ref{weil_reci_fp_r}:
\begin{eqnarray*}
\prod_{S \in E} \lsym{f_P}{r}{S}
& = & \lsym{f_P}{r}{Q'} \lsym{f_P}{r}{Q' - Q}
      \prod_{\ord_S(f_P) > 0} \lsym{f_P}{r}{S}
      \prod_{\ord_S(f_P) < 0} \lsym{f_P}{r}{S} \\
& = & w(P, Q)^{-1} f_P'(Q) \frac{1}{f_Q'(P)} (-1)^n\frac{f_Q'}{f_P'}(\ecident)
\end{eqnarray*}
Zgodnie z prawem wzajemności Weila przyrównujemy wynik do jedynki
i otrzymujemy:
\begin{eqnarray*}
1
& = &
w(P, Q)^{-1} f_P'(Q) \frac{1}{f_Q'(P)} (-1)^n\frac{f_Q'}{f_P'}(\ecident)
\\
w(P, Q)
& = &
(-1)^n \frac{f_P'(Q)}{f_Q'(P)} \frac{f_Q'}{f_P'}(\ecident)
\\
w(P, Q)
& = &
w'(P, Q)
\end{eqnarray*}
\end{proof}
