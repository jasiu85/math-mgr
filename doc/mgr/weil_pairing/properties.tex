\section{Własności}

Zbadamy teraz podstawowe własności iloczynu Weila.

\subsection*{Pierwiastki z jedności}

Zaczniemy od pokazania, że wartości, jakie przyjmuje iloczyn Weila,
to pierwiastki z jedynki.

\begin{theorem}
Dana jest krzywa eliptyczna $E$ oraz punkty $P, Q \in E[n]$.
Wówczas $w(P,Q)^n = 1$.
\end{theorem}

\begin{proof}
Rozważmy następujące wyrażenie:
\begin{equation*}
g_P \circ \underbrace{t_Q \circ \cdots \circ t_Q}_{n\textrm{ razy}}
\end{equation*}
Składanie funkcji jest łączne,
zatem wyrażenie to można ponawiasować na wiele sposobów.
Rozważmy dwa szczególne nawiasowania.
\begin{enumerate}
\item
Nawiasujemy od lewej do prawej:
\begin{eqnarray*}
g_P \circ \underbrace{t_Q \circ \cdots \circ t_Q}_{n\textrm{ razy}}
& = & ((\cdots((g_P \circ t_Q) \circ
      \underbrace{t_Q) \circ \cdots ) \circ t_Q)}_{n-1\textrm{ razy}} \\
& = & ((\cdots(((w(P,Q)g_P) \circ t_Q) \circ
      \underbrace{t_Q) \circ \cdots ) \circ t_Q)}_{n-2\textrm{ razy}} \\
& = & w(P,Q)((\cdots((g_P \circ t_Q) \circ
      \underbrace{t_Q) \circ \cdots ) \circ t_Q)}_{n-2\textrm{ razy}} \\
& = & \ldots \\
& = & w(P,Q)^ng_P
\end{eqnarray*}
\item
Nawiasujemy od prawej do lewej:
\begin{eqnarray*}
g_P \circ \underbrace{t_Q \circ \cdots \circ t_Q}_{n\textrm{ razy}}
& = & (g_P \circ
      \underbrace{(t_Q \circ \cdots \circ (t_Q}_{n-1\textrm{ razy}}
      \circ\,t_Q)\cdots)) \\
& = & (g_P \circ
      \underbrace{(t_Q \circ \cdots \circ (t_Q}_{n-2\textrm{ razy}}
      \circ\,t_{2Q})\cdots)) \\
& = & \ldots \\
& = & g_P \circ t_{nQ} \\
& = & g_P
\end{eqnarray*}
\end{enumerate}
Z porównania wyników obu nawiasowań widzimy, że $w(P,Q)^n = 1$.
\end{proof}

\begin{remark}
Przeciwdziedzinę iloczynu Weila będziemy odtąd oznaczać $\mu_n$ --
jest to grupa multiplikatywna pierwiastków $n$-tego stopnia
z jedności.
\end{remark}

\subsection*{Odwzorowanie dwuliniowe}

Wykażemy teraz własność iloczynu Weila,
która jest jednym z ważnych powodów jego użyteczności.
Własnością tą jest tzw. dwuliniowość.

\begin{definition}
Dane są: grupa addytywna $\G_1$ oraz grupa multiplikatywna $\G_2$.
Odwzorowanie $b\colon \G_1 \times \G_1 \to \G_2$
jest \emph{dwuliniowe},
jeżeli dla dowolnych elementów $P, P_1, P_2, Q, Q_1, Q_2 \in \G_1$ zachodzi:
\begin{itemize}
\item $b(P_1 + P_2, Q) = b(P_1, Q)b(P_2, Q)$;
\item $b(P, Q_1 + Q_2) = b(P, Q_1)b(P, Q_2)$.
\end{itemize}
\end{definition}

Sprawdźmy, że iloczyn Weila spełnia obie wymagane tożsamości.

\begin{lemma}
Dana jest krzywa eliptyczna $E$ oraz punkty $P_1, P_2, Q \in E[n]$.
Wówczas:
\begin{equation}
w(P_1 + P_2, Q) = w(P_1, Q)w(P_2, Q)
\end{equation}
\end{lemma}

\begin{proof}
Policzmy dywizor funkcji $\frac{f_{P_1 + P_2}}{f_{P_1}f_{P_2}}$.
Otrzymujemy:
\begin{equation*}
\rdiv\left(\frac{f_{P_1 + P_2}}{f_{P_1}f_{P_2}}\right) =
[n]^{-1}(P_1 + P_2) - [n]^{-1}(P_1) - [n]^{-1}(P_2) + [n]^{-1}(\ecident)
\end{equation*}
Niech $h$ będzie dowolną funkcją wymierną,
której dywizor jest równy
$\divi{P_1 + P_2} - \divi{P_1} - \divi{P_2} + \divi{\ecident}$.
Rozważmy dywizor funkcji $h \circ [n]$.
Funkcja ta ma miejsce zerowe w każdym takim punkcie $R$,
że $nR = P_1 + P_2$ lub $nR = \ecident$
oraz biegun w każdym takim punkcie $R$,
że $nR = P_1$ lub $nR = P_2$.
Po sprawdzeniu krotności miejsc zerowych i biegunów
oraz uwzględnieniu faktu,
mogą się one nałożyć i ,,wzmocnić'' lub ,,znieść'',
otrzymujemy:
\begin{equation*}
\rdiv(h \circ [n]) =
[n]^{-1}(P_1 + P_2) - [n]^{-1}(P_1) - [n]^{-1}(P_2) + [n]^{-1}(\ecident)
\end{equation*}
Zatem $\frac{f_{P_1 + P_2}}{f_{P_1}f_{P_2}} = c(h \circ [n])$.
Zauważmy teraz, że funkcja $h \circ [n]$ jest niezmiennicza
ze względu na przesunięcia o element $S \in E[n]$:
\begin{eqnarray*}
((h \circ [n]) \circ t_S)(R)
& = & h([n](t_S(R))) \\
& = & h([n](R + S)) \\
& = & h(nR + nS) \\
& = & h(nR) \\
& = & (h \circ [n])(R)
\end{eqnarray*}
Zatem funkcja $\frac{f_{P_1 + P_2}}{f_{P_1}f_{P_2}}$
również jest niezmiennicza ze względu na takie przesunięcia.
Wykorzystamy ten fakt, aby przekształcić wzór na wartość $w(P_1 + P_2, Q)$:
\begin{eqnarray*}
w(P_1 + P_2, Q)
& = & \frac{f_{P_1 + P_2} \circ t_Q}{f_{P_1 + P_2}} \\
& = & \frac{f_{P_1 + P_2} \circ t_Q}{f_{P_1 + P_2}}
      \frac{f_{P_1}f_{P_2}}{f_{P_1}f_{P_2}} \\
& = & \frac{f_{P_1 + P_2} \circ t_Q}{f_{P_1}f_{P_2}}
      \frac{f_{P_1}f_{P_2}}{f_{P_1 + P_2}} \\
& = & \frac{f_{P_1 + P_2} \circ t_Q}{f_{P_1}f_{P_2}}
      \left(\left(\frac{f_{P_1}f_{P_2}}{f_{P_1 + P_2}}\right) \circ t_Q\right)
      \\
& = & \frac{f_{P_1 + P_2} \circ t_Q}{f_{P_1}f_{P_2}}
      \frac{(f_{P_1} \circ t_Q)(f_{P_2} \circ t_Q)}{f_{P_1 + P_2} \circ t_Q} \\
& = & \frac{(f_{P_1} \circ t_Q)(f_{P_2} \circ t_Q)}{f_{P_1}f_{P_2}} \\
& = & w(P_1, Q)w(P_2, Q)
\end{eqnarray*}
\end{proof}

\begin{lemma}
Dana jest krzywa eliptyczna $E$ oraz punkty $P, Q_1, Q_2 \in E[n]$.
Wówczas:
\begin{equation}
w(P, Q_1 + Q_2) = w(P, Q_1)w(P, Q_2)
\end{equation}
\end{lemma}

\begin{proof}
Tym razem wystarczy zamienić $t_{Q_1 + Q_2}$ na $t_{Q_1} \circ t_{Q_2}$
we wzorze na $w(P, Q_1 + Q_2)$:
\begin{eqnarray*}
w(P, Q_1 + Q_2)
& = & \frac{f_P \circ t_{Q_1 + Q_2}}{f_P} \\
& = & \frac{f_P \circ (t_{Q_1} \circ t_{Q_2})}{f_P} \\
& = & \frac{(f_P \circ t_{Q_1}) \circ t_{Q_2})}{f_P} \\
& = & \frac{((w(P,Q_1)f_P) \circ t_{Q_2})}{f_P} \\
& = & w(P, Q_1)\frac{f_P \circ t_{Q_2}}{f_P} \\
& = & w(P, Q_1)w(P, Q_2)
\end{eqnarray*}
\end{proof}

\begin{corollary}
Iloczyn Weila $w\colon E[n] \times E[n] \to \mu_n$
jest odwzorowaniem dwuliniowym.
\end{corollary}

\subsection*{Wartości dla szczególnych argumentów}

Obliczymy teraz wartość iloczynu Weila
dla kilku specyficznych kombinacji punktów $P$ i $Q$.

Zaczniemy od przypadku, gdy $P = Q$.

\begin{theorem}
Dana jest krzywa eliptyczna $E$ oraz punkt $P \in E[n]$.
Wówczas $w(P, P) = 1$.
\end{theorem}

\begin{proof}
Niech $R$ będzie dowolnym punktem takim, że $nR = P$.
Przypomnijmy, że dywizor funkcji $f_P$
można przedstawić w następującej postaci:
\begin{equation*}
\rdiv(f_P) = \sum_{S \in E[n]} \divi{R + S} - \sum_{S \in E[n]} \divi{S}
\end{equation*}
Jeśli zbadamy miejsca zerowe i bieguny funkcji $f_P \circ t_{kR}$,
gdzie $k = 0, 1, \ldots, n-1$,
to otrzymamy, że jej dywizor jest równy:
\begin{equation*}
\rdiv(f_P \circ t_{kQ}) =
\sum_{S \in E[n]} \divi{(1-k)R + S} - \sum_{S \in E[n]} \divi{-kR + S}
\end{equation*}
Widzimy, że jest on równy $[n]^{-1}((1-k)P) - [n]^{-1}((-k)P)$.
Określmy funkcję $F$ następująco:
\begin{equation*}
F = \prod_{k=0}^{n-1} f_P \circ t_{kR}
\end{equation*}
Jej dywizor jest równy:
\begin{equation*}
\rdiv(F) = \sum_{k=0}^{n-1} [n]^{-1}((1-k)P) - [n]^{-1}((-k)P)
\end{equation*}
Jest to suma, która składa się teleskopowo, skąd otrzymujemy:
\begin{eqnarray*}
\rdiv(F)
& = & [n]^{-1}(P) - [n]^{-1}((1-n)P) \\
& = & [n]^{-1}(P) - [n]^{-1}(P) \\
& = & 0
\end{eqnarray*}
Funkcja $F$ jest zatem stała, więc $F = F \circ t_R$.
Po rozpisaniu tej równości dostajemy:
\begin{eqnarray*}
F
& = &
F \circ t_R
\\
\prod_{k=0}^{n-1} f_P \circ t_{kR}
& = &
(\prod_{k=0}^{n-1} f_P \circ t_{kR}) \circ t_{kR}
\\
\prod_{k=0}^{n-1} f_P \circ t_{kR}
& = &
\prod_{k=1}^{n} f_P \circ t_{kR}
\\
f_P
& = &
f_P \circ t_{nR}
\\
f_P
& = &
f_P \circ t_P
\end{eqnarray*}
Zatem $w(P,P) = \frac{f_P \circ t_P}{f_P} = \frac{f_P}{f_P} = 1$.
\end{proof}

Wynik ten uogólniamy na przypadek punktów ,,współliniowych''.
Pojęcie współliniowości bierze się stąd,
że grupa $E[n]$ jest izomorficzna z grupą $(\Z/n\Z)\times(\Z/n\Z)$,
która jest wolnym modułem wymiaru dwa nad pierścieniem $\Z/n\Z$.

\begin{theorem}
Dana jest krzywa eliptyczna $E$ oraz punkty $P, Q \in E[n]$.
Jeżeli istnieje punkt $R \in E[n]$ oraz liczby całkowite $k$ i $l$
takie, że $P = kR, Q = lR$, to $w(P, Q) = 1$.
\end{theorem}

\begin{proof}
Wykorzystamy dwuliniowość oraz to, że $w(R, R) = 1$:
\begin{eqnarray*}
w(P, Q)
& = & w(kR, Q) \\
& = & w(R, Q)^k \\
& = & w(R, lR)^k \\
& = & w(R, R)^{kl} \\
& = & 1
\end{eqnarray*}
\end{proof}

Następujące twierdzenie jest w pewnym sensie odwrotne do poprzedniego wyniku.

\begin{theorem}\label{weil_pairing_one_p_ecident}
Dana jest krzywa eliptyczna $E$ oraz punkt $P \in E[m]$.
Jeżeli $w(P, Q) = 1$ dla każdego punktu $Q \in E[m]$, to $P = \ecident$.
\end{theorem}

W dowodzie tego twierdzenia kluczową rolę odegra następujący lemat.

\begin{lemma}
Dana jest krzywa eliptyczna $E$ oraz funkcja wymierna $r$ na tej krzywej.
Jeżeli funkcja $r$ jest niezmiennicza ze względu na przesunięcie
o dowolny element $Q \in E[n]$, tzn. $r = r \circ t_Q$,
to funkcję $r$ można przedstawić w postaci $r = s \circ [n]$.
\end{lemma}

Nie podamy dowodu tego lematu -- objętość niniejszej pracy jest ograniczona,
a metody użyte w dowodzie wykraczają poza zakres pracy.

\begin{proof}[Dowód twierdzenia \ref{weil_pairing_one_p_ecident}]
Z założenia mamy $f_P \circ t_Q = f_P$,
więc na mocy lematu $f_P = s \circ [m]$.
Porównując dywizor funkcji $f_P$ z kształtem funkcji $s \circ [m]$
otrzymujemy, że $\rdiv(s) = \divi{P} - \divi{\ecident}$.
Korzystamy z lematu \ref{sim_pq_eq_pq_lemma} i dostajemy $P = \ecident$.
\end{proof}

\subsection*{Niezdegenerowanie}

Mogłoby zdarzyć się, że iloczyn Weila jest funkcją stałą,
a na dodatek równą $1$. Tak jednak nie jest.

\begin{theorem}
Dana jest krzywa eliptyczna $E$ oraz punkty $P, Q \in E[n]$.
Jeżeli punkty $P$ i $Q$ są generatorami grupy $E[n]$,
to $w(P, Q)$ jest pierwiastkiem pierwotnym $n$-tego stopnia z jedności.
\end{theorem}

\begin{proof}
Skoro $P$ i $Q$ są generatorami grupy $E[n]$,
to $\ord(P) = n$ oraz $\ord(Q) = n$.
Dalej, każdy punkt $R \in E[n]$ można przedstawić w postaci $R = kP + lQ$.
Niech $\ord(w(P,Q)) = m$,
tzn. $m$ jest najmniejszą liczbą całkowitą dodatnią taką,
że $w(P,Q)^m = 1$.
Obliczmy wartość $w(mP, R)$:
\begin{eqnarray*}
w(mP, R)
& = & w(mP, kP + lQ) \\
& = & w(P,P)^{mk}(w(P,Q)^m)^l \\
& = & 1
\end{eqnarray*}
Z twierdzenia \ref{weil_pairing_one_p_ecident} otrzymujemy,
że $mP = \ecident$. Stąd $n \mid m$, bo $n$ jest rzędem punktu $P$
w grupie $E[n]$. Z drugiej strony, zawsze mamy $w(P, Q)^n = 1$,
zatem $m \mid n$. Ostatecznie otrzymujemy $n = m$.
\end{proof}

\subsection*{Antysymetria}

Z dwuliniowości łatwo pokazać, że iloczyn Weila jest antysymetryczny.

\begin{theorem}
Dana jest krzywa eliptyczna $E$ oraz punkty $P, Q \in E[n]$.
Wówczas $w(P, Q) = w(Q, P)^{-1}$.
\end{theorem}

\begin{proof}
Rozpiszmy z dwuliniowości wartość $w(P + Q, P + Q)$:
\begin{eqnarray*}
1
& = & w(P + Q, P + Q) \\
& = & w(P,P)w(P,Q)w(Q,P)w(Q,Q) \\
& = & w(P, Q)w(Q, P)
\end{eqnarray*}
\end{proof}
